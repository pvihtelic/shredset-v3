<div class="content">

<div class="page-header">
    <h3>Comparison shopping for skis.</h3>        
</div>

<div class="row">
    <div class="span4">
    <div class="content-left-home">
        <h5 class="search-headline">Search <%= Ski.all.count %> skis </h5>  
        <%= form_tag skis_url, :method=>:get do %>
            <div class="field">
                <%= collection_select(:ski, :ski_type, @ski_types, :ski_type, :ski_type, {}, :multiple => true, :class=>'chzn-select', :'data-placeholder' => "Enter Ski Type") %>
            </div>
            <div class="field">
                <%= collection_select(:ski, :gender, @genders, :gender, :gender, {}, :multiple => true, :class=>'chzn-select', :'data-placeholder' => "Enter Gender/Youth") %>
            </div>
            <div class="field">
                <%= collection_select(:ski, :ability_level, @ability_levels, :ability_level, :ability_level, {}, :multiple => true, :class => "chzn-select", :'data-placeholder' => "Enter Ability Level") %>
            </div>
            <div class="field">
                <%= collection_select(:brand, :company, @brands, :id, :company, {}, :multiple => true, :class => "chzn-select", :'data-placeholder' => "Enter Brand") %>
            </div>
            <div class="field">
                <%= collection_select(:ski, :name, @names, :name, :name, {}, :multiple => true, :class => "chzn-select", :'data-placeholder' => "Enter Specific Model") %>
            </div>
            <div class="field">
                <%= collection_select(:price_range, :price_range, @price_ranges, :price_range, :price_range, {}, :multiple => true, :class => "chzn-select", :'data-placeholder' => "Enter Price Range") %>
            </div>
            <div class="field">
                <%= submit_tag "Search", :class=>"btn" %>
            </div>          
        <% end %>
    </div>
    </div>
    <ul class="products">
    <% @overlapping_skis.each do |ski| %>
            <li class="product-item">
            <%= link_to image_tag(ski.images.first.image_url, :class => "index-product-image"), ski_url(ski.id) %>
            <br />
            <ul class="product-details">
                <li class="product-details">
                    <span class="product-title">
                    <%= ski.brand.company %> <%= ski.name %> </br>
                    </span>
                    <% @b = [] %>
                        <% ski.inventories.each do |inventory| %>
                            <% if !@b.include? inventory.store_id %>
                            <% @b.push(inventory.store_id) %>
                            <% end %>
                        <% end %>
                        Available at <%= @b.count %> 
                        <% if @b.count>1%> stores <% else %> store
                        <% end %>
                    <% a = [] %>
                    <% ski.inventories.each do |inventory| %>
                        <% a.push(number_to_currency(inventory.price)) %>
                        <% end %>
                        <% @lowest_price = a.sort { |x,y| x <=> y} %>
                        from <%= @lowest_price.first %>
                    </br>
                </li>
            </ul>
    <% end %>
    </ul>

</div>
</div>
<br />

<%= link_to 'New Ski', new_ski_path %>
